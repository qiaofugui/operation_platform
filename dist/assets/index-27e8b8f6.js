import{b3 as N,a as te,r as d,h as H,k as a,f as _,g as L,w as l,y as e,s as $,F as D,af as G,Q as F,bd as he,b5 as C,R as ce,S as pe,bi as me,bj as fe,bk as Pe,bl as Le,U as _e,c as xe,P as Ce,a$ as J,t as Ee,am as re,E as Ne,bh as we,bc as $e,a1 as De,j as Y,v as le,bg as ze,ar as Fe,b0 as Te}from"./index-210d6226.js";import{E as ge}from"./el-dialog-1dbfa577.js";import"./el-overlay-ec3f63dc.js";import{E as ae}from"./el-image-viewer-31cddf52.js";import{E as Be}from"./el-pagination-d0f2d817.js";import{a as oe,b as ne,v as ue,E as ve}from"./el-badge-a9571a8e.js";/* empty css                   */import{E as se}from"./el-button-eb82824f.js";import{_ as Re}from"./plus-22e5efcc.js";import{E as Ke}from"./el-progress-dd92a3d6.js";/* empty css                */import"./refs-22be4dc6.js";import"./vnode-66f8c912.js";import"./position-ba0befc4.js";function je(g,h,y){return N({url:`/admin/product//${g}/${h}?category3Id=${y}`,method:"get"})}function de(){return N({url:"/admin/product/baseTrademark/getTrademarkList",method:"get"})}function Se(g){return N({url:`/admin/product/spuImageList/${g}`,method:"get"})}function be(g){return N({url:`/admin/product/spuSaleAttrList/${g}`,method:"get"})}function ie(){return N({url:"/admin/product/baseSaleAttrList",method:"get"})}function Oe(g){return g.id?N({url:"/admin/product/updateSpuInfo",method:"post",data:g}):N({url:"/admin/product/saveSpuInfo",method:"post",data:g})}function Ge(g){return N({url:`/admin/product/deleteSpu/${g}`,method:"delete"})}function Me(g){return N({url:"/admin/product/saveSkuInfo",method:"post",data:g})}function qe(g){return N({url:`/admin/product/findBySpuId/${g}`,method:"get"})}const He=te({__name:"skuForm",emits:["changeScene"],setup(g,{expose:h,emit:y}){let A=d(!1),u=d({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""}),U=d([]),S=d([]),x=d([]);const c=async(V,p,k)=>{A.value=!0,u.value.category3Id=k.category3Id,u.value.spuId=k.id,u.value.tmId=k.tmId;const r=await Promise.all([he(V,p,k.category3Id),be(k.id),Se(k.id)]);U.value=r[0].data,S.value=r[1].data,x.value=r[2].data,A.value=!1};let T=d(null);const B=V=>{u.value.skuDefaultImg=V.imgUrl,T.value.clearSelection(),T.value.toggleRowSelection(V,!0)},w=V=>V.imgUrl===u.value.skuDefaultImg,R=async()=>{u.value.skuAttrValueList=U.value.map(p=>({attrId:p.id,valueId:p.attrValueList[0].id})),u.value.skuSaleAttrValueList=S.value.map(p=>({saleAttrId:p.id,saleValueId:p.spuSaleAttrValueList[0].id}));const V=await Me(u);V.code===200?(C.success(V.message),y("changeScene",{flag:0,params:"update"})):C.error(V.message)},K=()=>{y("changeScene",{flag:0,params:"update"})};return h({initSkuData:c}),(V,p)=>{const k=ce,r=pe,E=me,M=fe,Q=Pe,m=Le,i=_e,j=oe,o=ae,t=se,f=ne,I=ue;return H((_(),L(i,{"label-width":"100px"},{default:l(()=>[e(r,{label:"SPU名称"},{default:l(()=>[e(k,{modelValue:a(u).skuName,"onUpdate:modelValue":p[0]||(p[0]=s=>a(u).skuName=s),placeholder:"请输入SPU名称","prefix-icon":"EditPen"},null,8,["modelValue"])]),_:1}),e(r,{label:"价格(元)"},{default:l(()=>[e(k,{modelValue:a(u).price,"onUpdate:modelValue":p[1]||(p[1]=s=>a(u).price=s),type:"number",placeholder:"请输入价格(元)","prefix-icon":"EditPen"},null,8,["modelValue"])]),_:1}),e(r,{label:"重量(克)"},{default:l(()=>[e(k,{modelValue:a(u).weight,"onUpdate:modelValue":p[2]||(p[2]=s=>a(u).weight=s),type:"number",placeholder:"请输入重量(克)","prefix-icon":"EditPen"},null,8,["modelValue"])]),_:1}),e(r,{label:"SKU描述"},{default:l(()=>[e(k,{modelValue:a(u).skuDesc,"onUpdate:modelValue":p[3]||(p[3]=s=>a(u).skuDesc=s),type:"textarea",placeholder:"请输入SKU描述"},null,8,["modelValue"])]),_:1}),e(r,{label:"平台属性"},{default:l(()=>[e(i,null,{default:l(()=>[e(m,{gutter:20,style:{"margin-bottom":"10px"}},{default:l(()=>[(_(!0),$(D,null,G(a(U),(s,P)=>(_(),L(Q,{span:8,key:s.id},{default:l(()=>[e(r,{label:s.attrName,"label-width":"100px",style:{"margin-bottom":"10px",overflow:"hidden"}},{default:l(()=>[e(M,{modelValue:a(u).skuAttrValueList[P],"onUpdate:modelValue":b=>a(u).skuAttrValueList[P]=b},{default:l(()=>[(_(!0),$(D,null,G(s.attrValueList,b=>(_(),L(E,{key:b.id,label:b.valueName,value:`${s.id}:${b.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(r),e(r,{label:"销售属性"},{default:l(()=>[e(i,{inline:!0},{default:l(()=>[(_(!0),$(D,null,G(a(S),(s,P)=>(_(),L(r,{key:s.id,label:s.saleAttrName},{default:l(()=>[e(M,{modelValue:a(u).skuSaleAttrValueList[P],"onUpdate:modelValue":b=>a(u).skuSaleAttrValueList[P]=b},{default:l(()=>[(_(!0),$(D,null,G(s.spuSaleAttrValueList,b=>(_(),L(E,{key:b.id,label:b.saleAttrValueName,value:`${s.id}:${b.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(r,{label:"图片名称"},{default:l(()=>[e(f,{ref_key:"table",ref:T,border:"",data:a(x)},{default:l(()=>[e(j,{type:"selection",align:"center",width:"80px",selectable:w}),e(j,{label:"图片"},{default:l(({row:s})=>[e(o,{style:{width:"100px",height:"100px"},src:s.imgUrl},null,8,["src"])]),_:1}),e(j,{label:"名称",prop:"imgName"}),e(j,{label:"操作"},{default:l(({row:s})=>[e(t,{type:"primary",size:"small",icon:"Select",onClick:P=>B(s)},{default:l(()=>[F("设置默认")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(r,null,{default:l(()=>[e(t,{type:"primary",icon:"Select",onClick:R},{default:l(()=>[F("保存")]),_:1}),e(t,{icon:"CloseBold",onClick:K},{default:l(()=>[F("取消")]),_:1})]),_:1})]),_:1})),[[I,a(A)]])}}}),Je=te({__name:"spuForm",emits:["changeScene"],setup(g,{expose:h,emit:y}){const A=()=>{y("changeScene",{flag:0,params:"update"})};let u=d([]),U=d([]),S=d([]),x=d([]);const c=d({category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),T=async o=>{c.value=o,B.value=!0;const t=await Promise.all([de(),Se(o.id),be(o.id),ie()]);u.value=t[0].data,U.value=t[1].data.map(f=>({name:f.imgName,url:f.imgUrl})),S.value=t[2].data,x.value=t[3].data,B.value=!1},B=d(!1);let w=d(!1),R=d("");const K=o=>{console.log(o),R.value=o.url,w.value=!0},V=(o,t)=>{console.log(o,t)},p=o=>{if(["image/jpg","image/jpeg","image/png","image/gif"].includes(o.type)){if(o.size/1024/1024>4)return C.error("图片大小不能超过4MB!"),!1}else return C.error("图片必须是JPG|PNG|GIF格式!"),!1;return!0};let k=xe(()=>x.value.filter(o=>S.value.every(t=>o.name!==t.saleAttrName))),r=d("");const E=()=>{const[o,t]=r.value.split(":");let f={baseSaleAttrId:o,saleAttrName:t,spuSaleAttrValueList:[]};S.value.push(f),r.value=""},M=(o,t)=>{o.flag=!0,o.saleAttrValue="",re(()=>{m.value[t].focus()})},Q=(o,t)=>{const{baseSaleAttrId:f,saleAttrValue:I}=o;let s={baseSaleAttrId:f,saleAttrName:I};if(I.trim()==="")return o.flag=!1,C.warning("属性值不能为空");if(o.spuSaleAttrValueList.find(b=>b.saleAttrName===I)){C.warning("属性值已存在"),re(()=>{m.value[t].select()});return}o.spuSaleAttrValueList.push(s),o.flag=!1};let m=d([]);const i=async()=>{c.value.spuImageList=U.value.map(t=>({imgName:t.name,imgUrl:t.response&&t.response.data||t.url})),c.value.spuSaleAttrList=S.value;const o=await Oe(c.value);o.code===200?(C.success(o.message),y("changeScene",{falg:0,params:c.value.category3Id?"update":"add"})):C.error(o.message)};return h({initSpuData:T,initAddSpu:async o=>{Object.assign(c.value,{category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),U.value=[],S.value=[],r.value="",c.value.category3Id=o;const t=await Promise.all([de(),ie()]);u.value=t[0].data,x.value=t[1].data}}),(o,t)=>{const f=ce,I=pe,s=me,P=fe,b=Ce("Plus"),Z=Ne,ee=Ke,O=se,q=oe,v=we,W=ve,ye=ne,ke=_e,Ve=ae,Ie=ge,Ae=ue;return _(),$(D,null,[e(ke,{"label-width":"100px"},{default:l(()=>[e(I,{label:"SPU名称"},{default:l(()=>[e(f,{placeholder:"请输入SPU名称","prefix-icon":"EditPen",modelValue:c.value.spuName,"onUpdate:modelValue":t[0]||(t[0]=n=>c.value.spuName=n)},null,8,["modelValue"])]),_:1}),e(I,{label:"SPU品牌"},{default:l(()=>[e(P,{modelValue:c.value.tmId,"onUpdate:modelValue":t[1]||(t[1]=n=>c.value.tmId=n)},{default:l(()=>[(_(!0),$(D,null,G(a(u),n=>(_(),L(s,{key:n.id,label:n.tmName,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(I,{label:"SPU描述"},{default:l(()=>[e(f,{type:"textarea",placeholder:"请输入SPU描述",rows:2,modelValue:c.value.description,"onUpdate:modelValue":t[2]||(t[2]=n=>c.value.description=n)},null,8,["modelValue"])]),_:1}),e(I,{label:"SPU图片"},{default:l(()=>[H((_(),L(ee,{"file-list":a(U),"onUpdate:fileList":t[3]||(t[3]=n=>J(U)?U.value=n:U=n),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":K,"on-remove":V,"before-upload":p},{default:l(()=>[e(Z,null,{default:l(()=>[e(b)]),_:1})]),_:1},8,["file-list"])),[[Ae,B.value]])]),_:1}),e(I,{label:"SPU销售属性"},{default:l(()=>[e(P,{style:{"margin-right":"10px"},placeholder:a(k).length?"请选择销售属性":"暂无属性供选择",modelValue:a(r),"onUpdate:modelValue":t[4]||(t[4]=n=>J(r)?r.value=n:r=n)},{default:l(()=>[(_(!0),$(D,null,G(a(k),n=>(_(),L(s,{key:n.id,label:n.name,value:`${n.id}:${n.name}`},null,8,["label","value"]))),128))]),_:1},8,["placeholder","modelValue"]),e(O,{type:"primary",icon:"Plus",disabled:!a(r),onClick:E},{default:l(()=>[F("添加属性值")]),_:1},8,["disabled"]),e(ye,{border:"",style:{margin:"10px 0"},data:a(S)},{default:l(()=>[e(q,{label:"序号",type:"index",width:"80px",align:"center"}),e(q,{label:"属性名",width:"160px",prop:"saleAttrName"}),e(q,{label:"属性值"},{default:l(({row:n,$index:X})=>[(_(!0),$(D,null,G(n.spuSaleAttrValueList,(z,Ue)=>(_(),L(v,{type:"success",key:z.id,style:{margin:"3px"},closable:"",onClose:Qe=>n.spuSaleAttrValueList.splice(Ue,1)},{default:l(()=>[F(Ee(z.saleAttrName),1)]),_:2},1032,["onClose"]))),128)),n.flag?(_(),L(f,{key:0,modelValue:n.saleAttrValue,"onUpdate:modelValue":z=>n.saleAttrValue=z,style:{width:"150px"},size:"small",placeholder:"请输入属性值",onBlur:z=>Q(n,X),ref:z=>a(m)[X]=z},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(_(),L(O,{key:1,type:"primary",size:"small",icon:"Plus",onClick:z=>M(n,X)},null,8,["onClick"]))]),_:1}),e(q,{label:"操作"},{default:l(({row:n})=>[e(W,{title:`确定要删除 ${n.saleAttrName} 吗?`,icon:"DeleteFilled","icon-color":"#f56c6c",onConfirm:X=>a(S).splice(a(S).indexOf(n),1)},{reference:l(()=>[e(O,{type:"danger",size:"small",icon:"Delete"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(O,{type:"primary",icon:"Select",onClick:i},{default:l(()=>[F("保存")]),_:1}),e(O,{icon:"CloseBold",onClick:A},{default:l(()=>[F("取消")]),_:1})]),_:1})]),_:1}),e(Ie,{modelValue:a(w),"onUpdate:modelValue":t[5]||(t[5]=n=>J(w)?w.value=n:w=n),width:"35%"},{default:l(()=>[e(Ve,{src:a(R),style:{width:"100%",height:"100%"},fit:"cover"},null,8,["src"])]),_:1},8,["modelValue"])],64)}}}),il=te({__name:"index",setup(g){const h=$e();let y=d(0),A=d(1),u=d(3),U=d(0),S=d([]);const x=d(!1);De(()=>h.c3Id,()=>{if(!h.c3Id)return S.value=[];c()});const c=async(m=1)=>{A.value=m,x.value=!0;const i=await je(A.value,u.value,h.c3Id);i.code===200&&(S.value=i.data.records,U.value=i.data.total),x.value=!1},T=m=>{c(m)},B=()=>{c()},w=()=>{y.value=1,K.value.initAddSpu(h.c3Id)},R=m=>{y.value=m.flag,m.params==="update"?c(A.value):c()},K=d(null),V=m=>{y.value=1,K.value.initSpuData(m)},p=d(null),k=m=>{y.value=2,p.value.initSkuData(h.c1Id,h.c2Id,m)};let r=d([]),E=d(!1);const M=async m=>{const i=await qe(m.id);i.code===200?(r.value=i.data,E.value=!0):C.error(i.message)},Q=async m=>{const i=await Ge(m.id);i.code===200?(C.success(i.message),c(S.value.length>1?A.value:1)):C.error(i.message)};return(m,i)=>{const j=ze,o=Re,t=se,f=oe,I=Fe,s=ve,P=ne,b=Be,Z=Te,ee=ae,O=ge,q=ue;return _(),$(D,null,[Y("div",null,[e(j,{scene:a(y)},null,8,["scene"]),e(Z,{style:{margin:"10px 0"}},{default:l(()=>[H(Y("div",null,[e(t,{type:"primary",disabled:!a(h).c3Id,onClick:w},{default:l(()=>[e(o),F(" 添加属性 ")]),_:1},8,["disabled"]),H((_(),L(P,{style:{margin:"10px 0"},border:"",data:a(S)},{default:l(()=>[e(f,{label:"序号",type:"index",width:"80px",align:"center",prop:"id"}),e(f,{prop:"spuName",label:"SPU名称"}),e(f,{prop:"description",label:"SPU描述","show-overflow-tooltip":""}),e(f,{label:"SPU操作",width:"205px"},{default:l(({row:v})=>[e(I,{effect:"dark",content:"添加SKU",placement:"bottom"},{default:l(()=>[e(t,{type:"primary",size:"small",icon:"Plus",onClick:W=>k(v)},null,8,["onClick"])]),_:2},1024),e(I,{effect:"dark",content:"修改SPU",placement:"bottom"},{default:l(()=>[e(t,{type:"success",size:"small",icon:"Edit",onClick:W=>V(v)},null,8,["onClick"])]),_:2},1024),e(I,{effect:"dark",content:"查看SPU列表",placement:"bottom"},{default:l(()=>[e(t,{type:"info",size:"small",icon:"View",onClick:W=>M(v)},null,8,["onClick"])]),_:2},1024),e(s,{title:`确定要删除 ${v.spuName} 吗?`,icon:"DeleteFilled","icon-color":"#f56c6c",onConfirm:W=>Q(v)},{reference:l(()=>[e(t,{type:"danger",size:"small",icon:"Delete"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])),[[q,x.value]]),e(b,{"current-page":a(A),"onUpdate:currentPage":i[0]||(i[0]=v=>J(A)?A.value=v:A=v),"page-size":a(u),"onUpdate:pageSize":i[1]||(i[1]=v=>J(u)?u.value=v:u=v),"page-sizes":[3,5,10,30],background:!0,layout:"prev, pager, next, jumper, ->, sizes, total",total:a(U),onSizeChange:B,onCurrentChange:T},null,8,["current-page","page-size","total"])],512),[[le,a(y)===0]]),H(Y("div",null,[e(Je,{ref_key:"spuFormRef",ref:K,onChangeScene:R},null,512)],512),[[le,a(y)===1]]),H(Y("div",null,[e(He,{ref_key:"skuFormRef",ref:p,onChangeScene:R},null,512)],512),[[le,a(y)===2]])]),_:1})]),e(O,{modelValue:a(E),"onUpdate:modelValue":i[2]||(i[2]=v=>J(E)?E.value=v:E=v),title:"SKU列表"},{default:l(()=>[e(P,{border:"",data:a(r)},{default:l(()=>[e(f,{label:"SKU名称",prop:"skuName","show-overflow-tooltip":""}),e(f,{label:"SKU价格",prop:"price"}),e(f,{label:"SKU重量",prop:"weight"}),e(f,{label:"SKU图片"},{default:l(({row:v})=>[e(ee,{style:{width:"100px",height:"100px"},src:v.skuDefaultImg,fit:"cover"},null,8,["src"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])],64)}}});export{il as default};
