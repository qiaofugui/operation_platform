import{b3 as y,a as pe,r as u,o as fe,b4 as ge,f as V,s as q,y as l,w as t,k as r,W as _,Q as i,h as O,g as E,j as N,t as G,p as M,F as ve,ag as _e,b5 as f,an as Q,R as be,S as he,U as we,b0 as Ve,X as ye,Y as Ce,V as Ue}from"./index-36d7dce8.js";import{E as xe,a as ke,b as Ee,c as Pe,d as Se,v as Re}from"./el-badge-8a30333f.js";import"./el-overlay-7dffd50a.js";import{E as Ie}from"./el-pagination-78a7e002.js";/* empty css                   */import{E as ze}from"./el-button-03af9eda.js";import{u as Ae}from"./setting-cefad139.js";import{E as De}from"./index-5f818760.js";import"./vnode-612af2fe.js";function Ne(d,R,m){return y({url:`/admin/acl/user/${d}/${R}`,method:"get",params:{username:m}})}function Fe(d){return d.id?y({url:"/admin/acl/user/update",method:"put",data:d}):y({url:"/admin/acl/user/save",method:"post",data:d})}function $e(d){return y({url:`/admin/acl/user/toAssign/${d}`,method:"get"})}function Be(d){return y({url:"/admin/acl/user/doAssignRole",method:"post",data:d})}function Le(d){return y({url:`/admin/acl/user/remove/${d}`,method:"delete"})}function Te(d){return y({url:"/admin/acl/user/batchRemove",method:"delete",data:d})}const je=d=>(ye("data-v-09ef8eb0"),d=d(),Ce(),d),qe=je(()=>N("h2",null,"分配用户角色",-1)),Oe=pe({__name:"index",setup(d){let R=Ae(),m=u(1),U=u(3),F=u(0),I=u(!1),P=u([]);const W=o=>{b(o)},X=()=>{b()},b=async(o=1)=>{m.value=o,I.value=!0;const e=await Ne(m.value,U.value,C.value);if(e.code!==200)return f.error(e.message);P.value=e.data.records,F.value=e.data.total,I.value=!1};fe(()=>{b()});let p=u(!1),S=u(null),n=u({username:"",name:"",password:"",rePassword:""}),Y=u({username:[{required:!0,trigger:"blur",validator:(o,e,s)=>{e.trim().length>=5?s():s(new Error("用户名称长度最少五位"))}}],name:[{required:!0,trigger:"blur",validator:(o,e,s)=>{e.trim().length>=5?s():s(new Error("用户昵称长度最少五位"))}}],password:[{required:!0,trigger:"blur",validator:(o,e,s)=>{e.trim().length>=5?s():s(new Error("用户密码长度最少六位"))}}],rePassword:[{required:!0,trigger:"change",validator:(o,e,s)=>{e===n.value.password?s():s(new Error("两次密码不一致"))}}]});const H=()=>{Object.assign(n.value,{id:0,username:"",name:"",password:"",rePassword:""}),Q(()=>{S.value.clearValidate()}),p.value=!0},J=o=>{Q(()=>{var e;(e=S.value)==null||e.clearValidate()}),Object.assign(n.value,o),p.value=!0},K=async()=>{await S.value.validate();const o=await Fe(n.value);if(o.code!==200)return f.error(o.message);p.value=!1,f.success(o.message),b(n.id?m.value:1)};let g=u(!1),x=u([]),w=u([]);const Z=async o=>{Object.assign(n.value,o);const e=await $e(o.id);if(e.code!==200)return f.error(e.message);x.value=e.data.allRolesList,w.value=e.data.assignRoles,g.value=!0};let k=u(!1),z=u(!1);const ee=o=>{w.value=o?x.value:[],z.value=!1},le=o=>{const e=o.length;k.value=e===x.value.length,z.value=e>0&&e<x.value.length},ae=async()=>{let o={userId:n.value.id,roleIdList:w.value.map(s=>s.id)};const e=await Be(o);if(e.code!==200)return f.error(e.message);f.success(e.message),b(m.value),g.value=!1},te=async o=>{const e=await Le(o.id);if(e.code!==200)return f.error(e.message);f.success(e.message),b(P.value.length>1?m.value:1)};let A=u([]);const oe=o=>{A.value=o},re=async()=>{let o=A.value.map(s=>s.id);const e=await Te(o);if(e.code!==200)return f.error(e.message);f.success(e.message),b(P.value.length>1?m.value:1)};let C=u("");const se=()=>{b()},ne=()=>{R.changeRefresh()};return(o,e)=>{const s=be,h=he,c=ze,D=we,$=Ve,B=xe,v=ke,de=Ee,ue=Ie,L=De,T=Pe,ie=Se,me=ge("has"),ce=Re;return V(),q("div",null,[l($,{style:{height:"75px"}},{default:t(()=>[l(D,{inline:!0,class:"form"},{default:t(()=>[l(h,{label:"用户名"},{default:t(()=>[l(s,{modelValue:r(C),"onUpdate:modelValue":e[0]||(e[0]=a=>_(C)?C.value=a:C=a),placeholder:"输入用户名进行搜索","prefix-icon":"Search"},null,8,["modelValue"])]),_:1}),l(h,null,{default:t(()=>[l(c,{type:"primary",icon:"Search",disabled:!r(C),onClick:se},{default:t(()=>[i("搜索")]),_:1},8,["disabled"]),l(c,{icon:"Refresh",onClick:ne},{default:t(()=>[i("重置")]),_:1})]),_:1})]),_:1})]),_:1}),l($,{style:{margin:"10px 0"}},{default:t(()=>[O((V(),E(c,{type:"primary",icon:"Plus",onClick:H},{default:t(()=>[i("添加")]),_:1})),[[me,"btn.User.add"]]),l(B,{title:"确定要批量删除选中的用户吗?",icon:"DeleteFilled","icon-color":"#f56c6c",onConfirm:re},{reference:t(()=>[l(c,{type:"danger",icon:"Delete",disabled:!r(A).length},{default:t(()=>[i("批量删除")]),_:1},8,["disabled"])]),_:1}),O((V(),E(de,{style:{margin:"10px 0"},border:"",data:r(P),onSelectionChange:oe},{default:t(()=>[l(v,{type:"selection",align:"center",width:"50px"}),l(v,{type:"index",label:"#",align:"center",width:"60px"}),l(v,{prop:"id",label:"ID"}),l(v,{prop:"username",label:"用户名"}),l(v,{prop:"name",label:"昵称"}),l(v,{prop:"roleName",label:"用户角色"}),l(v,{prop:"createTime",label:"创建时间","show-overflow-tooltip":""}),l(v,{prop:"updateTime",label:"更新时间","show-overflow-tooltip":""}),l(v,{label:"操作",width:"265px"},{default:t(({row:a})=>[l(c,{type:"success",size:"small",icon:"User",onClick:j=>Z(a)},{default:t(()=>[i("分配角色")]),_:2},1032,["onClick"]),l(c,{type:"primary",size:"small",icon:"Edit",onClick:j=>J(a)},{default:t(()=>[i("编辑")]),_:2},1032,["onClick"]),l(B,{title:`确定要删除 ${a.username} 吗?`,icon:"DeleteFilled","icon-color":"#f56c6c",onConfirm:j=>te(a)},{reference:t(()=>[l(c,{type:"danger",size:"small",icon:"Delete"},{default:t(()=>[i("删除")]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])),[[ce,r(I)]]),l(ue,{"current-page":r(m),"onUpdate:currentPage":e[1]||(e[1]=a=>_(m)?m.value=a:m=a),"page-size":r(U),"onUpdate:pageSize":e[2]||(e[2]=a=>_(U)?U.value=a:U=a),"page-sizes":[3,5,10,30],background:!0,layout:"prev, pager, next, jumper, ->, sizes, total",total:r(F),onCurrentChange:W,onSizeChange:X},null,8,["current-page","page-size","total"])]),_:1}),l(L,{modelValue:r(p),"onUpdate:modelValue":e[8]||(e[8]=a=>_(p)?p.value=a:p=a),size:"25%"},{header:t(()=>[N("h4",null,G(r(n).id?"更新用户":"添加用户"),1)]),default:t(()=>[l(D,{"label-width":"80px",model:r(n),rules:r(Y),ref_key:"userForm",ref:S},{default:t(()=>[l(h,{label:"用户名称",prop:"username"},{default:t(()=>[l(s,{modelValue:r(n).username,"onUpdate:modelValue":e[3]||(e[3]=a=>r(n).username=a),placeholder:"请输入用户名称","prefix-icon":"User",clearable:""},null,8,["modelValue"])]),_:1}),l(h,{label:"用户昵称",prop:"name"},{default:t(()=>[l(s,{modelValue:r(n).name,"onUpdate:modelValue":e[4]||(e[4]=a=>r(n).name=a),placeholder:"请输入用户昵称","prefix-icon":"User",clearable:""},null,8,["modelValue"])]),_:1}),r(n).id?M("",!0):(V(),E(h,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[l(s,{modelValue:r(n).password,"onUpdate:modelValue":e[5]||(e[5]=a=>r(n).password=a),type:"password","show-password":"",placeholder:"请输入密码","prefix-icon":"Lock",clearable:""},null,8,["modelValue"])]),_:1})),r(n).id?M("",!0):(V(),E(h,{key:1,label:"确认密码",prop:"rePassword"},{default:t(()=>[l(s,{modelValue:r(n).rePassword,"onUpdate:modelValue":e[6]||(e[6]=a=>r(n).rePassword=a),type:"password","show-password":"",placeholder:"请确认密码","prefix-icon":"Lock",clearable:""},null,8,["modelValue"])]),_:1}))]),_:1},8,["model","rules"])]),footer:t(()=>[l(c,{type:"primary",icon:"Select",onClick:K},{default:t(()=>[i("确定")]),_:1}),l(c,{icon:"CloseBold",onClick:e[7]||(e[7]=a=>_(p)?p.value=!1:p=!1)},{default:t(()=>[i("取消")]),_:1})]),_:1},8,["modelValue"]),l(L,{modelValue:r(g),"onUpdate:modelValue":e[13]||(e[13]=a=>_(g)?g.value=a:g=a),size:"25%"},{header:t(()=>[qe]),default:t(()=>[l(D,null,{default:t(()=>[l(h,{label:"用户名称"},{default:t(()=>[l(s,{modelValue:r(n).username,"onUpdate:modelValue":e[9]||(e[9]=a=>r(n).username=a),"prefix-icon":"User",disabled:""},null,8,["modelValue"])]),_:1}),l(h,{label:"角色列表"},{default:t(()=>[N("div",null,[l(T,{indeterminate:r(z),modelValue:r(k),"onUpdate:modelValue":e[10]||(e[10]=a=>_(k)?k.value=a:k=a),onChange:ee},{default:t(()=>[i("全选")]),_:1},8,["indeterminate","modelValue"])]),l(ie,{modelValue:r(w),"onUpdate:modelValue":e[11]||(e[11]=a=>_(w)?w.value=a:w=a),onChange:le},{default:t(()=>[(V(!0),q(ve,null,_e(r(x),a=>(V(),E(T,{key:a.id,label:a},{default:t(()=>[i(G(a.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),footer:t(()=>[l(c,{type:"primary",icon:"Select",onClick:ae},{default:t(()=>[i("确定")]),_:1}),l(c,{icon:"CloseBold",onClick:e[12]||(e[12]=a=>_(g)?g.value=!1:g=!1)},{default:t(()=>[i("取消")]),_:1})]),_:1},8,["modelValue"])])}}});const tl=Ue(Oe,[["__scopeId","data-v-09ef8eb0"]]);export{tl as default};
